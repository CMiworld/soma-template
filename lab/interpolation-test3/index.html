<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<style type="text/css">
	.boldclass {
		font-weight: bold;
	}
	.myClass {
		color: #B06E00;
	}
	.myClass2 {
		color: #A60B60;
	}
	.myClass3 {
		color: #0B41A6;
	}
	.myClass4 {
		color: #85A907;
	}
	.myClass5 {
		color: #B00B00;
	}
	.myClass6 {
		color: #26988B;
	}
	.list0 {
		color: #266498;
	}
	.list1 {
		color: #8C2698;
	}
	.list2 {
		color: #BE2E00;
	}
	.data-cloak {
		display: none;
	}
</style>
<body>

<div>
	template 1
	<button class="render1">render 1</button>
</div>
<div>
	template 2
	<button class="render2">render 2</button>
</div>
<div>
	<button class="invalidate">invalidate</button>
	<button class="render-all">render all</button>
</div>
<div class="time"></div>

<div id="ct" class="data-cloak">
	<p class="boldclass {{cl}}"> class on div + text {{test1}} {{test1}} dummy{{test2}}dummy</p>
	<div id="ct2">
		<p class="boldclass {{cl}}">class on div + text {{test1}} dummy{{test2}}dummy</p>
	</div>
	<p class="{{cl2}}">class value on div</p>
	<p {{classname}}="myClass2">class name on div</p>
	<p class="{{getClass()}}">class function with path on div + text function {{getClass()}}</p>
	<p class="{{getClassParam('p1.p1','p2.p2')}}">class function on div with param + text function with param {{fnParam("p1.p1", "p2.p2")}}</p>
	<p class="{{functions.getClass()}}">class function on div + text function {{functions.fn1()}}</p>
	<p class="{{functions.getClassParam('p1.p1','p2.p2')}}">class function on div with param + text function with param {{functions.fnParam("p1.p1", "p2.p2")}}</p>
	<p class="{{functions.getClassParam(params.param1,params.param2)}}">class function on div with param var + text function with param var {{functions.fnParam(params.param1, params.param2)}}</p>
	<p>function deep {{functions.deep.fn1()}}</p>
	<p>text function + string params {{functions.fn2("hello", "world")}}</p>
	<p>do a interpolation skip here: <span data-skip>{{test1}}</span> but not here: {{test1}}</p>
	checked attribute on an input from boolean: <input type="checkbox" {{checked}}><br/>
	checked attribute on an input from function: <input type="checkbox" {{functions.checked()}}>
	<p><img data-src="{{img}}" width="60" height="60"></p>
	<p data-hide="{{hideValue}}">HIDE ON VALUE, THIS SHOULD NOT APPEAR!!</p>
	<p data-hide>HIDE ON VALUE, THIS SHOULD NOT APPEAR!!</p>
	<p data-hide="{{functions.hideFn()}}">HIDE ON FUNCTION, THIS SHOULD NOT APPEAR!!</p>
	<p style="display:none" data-show>show on value, this should appear</p>
	<p style="display:none" data-show="true">show on value, this should appear</p>
	<p style="display:none" data-show="{{showValue}}">show on value, this should appear</p>
	<p style="display:none" data-show="false">show on function, this should appear</p>
	<a data-href="http://{{link}}" target="_blank">This is link</a>
	<ul class="{{cl}}">
		<li data-repeat="item in people">
			{{item.name}} {{item.age}}
			<ul>
				<li data-repeat="item in item.people">
					{{item.name}} {{item.age}}
					<ul>
						<li data-repeat="item in item.people">
							{{item.name}} {{item.age}}
						</li>
					</ul>
				</li>
			</ul>
		</li>
	</ul>
	<ul>
		<div data-repeat="item in people">
			{{item.name}} {{item.age}}
			<div data-repeat="item in item.people">
				{{item.name}} {{item.age}}
				<div data-repeat="item in item.people">
					{{item.name}} {{item.age}}
				</div>
			</div>
		</div>
	</ul>
	<div>
		<div>
			<div>
				<p class="{{test3.obj.cl}}">deep div with deep data {{test3.obj.val}}</p>
			</div>
		</div>
	</div>
	<ul>
		<li class="{{cl2}}">repeat image with index: </li>
		<li class="{{cl2}}" data-repeat="r in rep">[{{$index}}]<p>{{r.val}}</p><p data-hide="{{r.hide}}">{{test1}}</p></li>
		<li class="{{cl2}}">after</li>
	</ul>
	<ul>
		<li>repeat image with index:</li>
			<li data-repeat="img in imgrep">
				assets/{{img}}{{$index}}.jpg<br/>
			<img data-src="assets/{{img}}{{$index}}.jpg" width="60" height="60">
		</li>
	</ul>
	<ul>
		<li>repeat on array:</li>
			<li data-repeat="item in arr">
				<div class="list{{$index}}">[{{$index}}] - {{item}}</div>
			</li>
		</li>
	</ul>
	<ul>
		<li>repeat on array containing object:</li>
		<li data-repeat="item in items">
			<div class="list{{$index}}">[{{$index}}] - {{item.name}} {{item.deep.other}}</div>
		</li>
	</ul>
	<ul class="ul-1">
		<li data-repeat="o in objarray" class="li-1" cclass="{{cl2}}">{{o.title}}
			<ul class="ul-2">
				<li data-repeat="d in o.data.arr" class="li2">{{$index}}</li>
			</ul>
		</li>
	</ul>
	<ul class="root"><li data-repeat="o in obj" class="{{cl2}}">A<ul class="second">
		<li data-repeat="d in o.data.arr">{{$index}}</li>
	</ul>
	</li>
	</ul>
	<ul>
		<li>repeat on object:</li>
		<li data-repeat="item in obj" class="{{cl2}}">{{$key}}: {{item.title}}
			<ul class="second">
				<li data-repeat="d in item.data.arr" data-hide="{{item.hide}}">{{$index}} {{d}} {{test3.obj.cl}}</li>
			</ul>
		</li>
	</ul>
	<ul>
		<li data-repeat="l1 in l0">
			<strong>Level 1, index {{$index}}:</strong>
			<ul>
				<li data-repeat="l2 in l1">
					<strong>Level 2, index {{$index}}:</strong>
					<ul>
						<li data-repeat="l3 in l2">
							<strong>Level 3, index {{$index}}:</strong> {{l3}} {{test3.obj.cl}} {{getClass()}} {{functions.getClass()}} {{functions.getClassParam('p1.p1','p2.p2')}}
						</li>
					</ul>
				</li>
			</ul>
		</li>
	</ul>
</div>

<script type="text/javascript" src="jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../../src/soma-template.js"></script>

<script type="text/javascript">

	var obj1 = {
		classname: 'class',
		img: "assets/img0.jpg",
		imgrep: [
			"img",
			"img"
		],
		rep: [
			{val:"val A", hide: false},
			{val:"val B", hide: true},
			{val:"val C", hide: false}
		],
		hideValue: true,
		showValue: true,
		link: "www.google.com",
		test1:"String 1 [v1]",
		test2:"String 2 [v1]",
		test3: {
			obj: {
				val: "val3 [v1]",
				cl: "myClass4"
			}
		},
		params: {
			param1: "p1.p1",
			param2: "p2.p2"
		},
		getClass: function(){ return "myClass"; },
		fnParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "fn value [v1]" : undefined; },
		getClassParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "myClass4" : undefined; },
		functions: {
			getClass: function(){ return "myClass4"; },
			getClassParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "myClass5" : undefined; },
			fn1: function(){ return "fn string returned [v1]"; },
			fn2: function(p1, p2){ return "fn string returned with: " + p1 + " " + p2 + " [v1]"; },
			fnParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "fn value [v1]" : undefined; },
			checked: function() { return "checked"; },
			hideFn: function(){ return true; },
			showFn: function(){ return true; },
			deep: {
				fn1: function(){ return "fn deep string returned [v1]"; }
			}
		},
		cl:"myClass",
		cl2:"myClass2",
		checked: 'checked',
		items: [{name:"zero [v1]", deep:{other:"1 [v1]"}}, {name:"one [v1]", deep:{other:"2 [v1]"}}, {name:"two [v1]", deep:{other:"3 [v1]"}}],
		arr:["zero [v1]", "one [v1]", "two [v1]"],
		obj: {
			item1: {
				title: "object containing arrays 1 [v1]",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			},
			item2: {
				title: "object containing arrays 2 [v1]",
				data: {
					arr: [1, 2, 3]
				},
				hide:true
			},
			item3: {
				title: "object containing arrays 3 [v1]",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			}
		},
		objarray: [
			{
				title: "object containing arrays 1",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			}
		],
		l0: [
			[
				["0-0-0 [v1]", "0-0-1 [v1]", "0-0-2 [v1]"],
				["0-1-0 [v1]", "0-1-1 [v1]", "0-1-2 [v1]"],
				["0-2-0 [v1]", "0-2-1 [v1]", "0-2-2 [v1]"]
			],
			[
				["1-0-0 [v1]", "1-0-1 [v1]", "1-0-2 [v1]"],
				["1-1-0 [v1]", "1-1-1 [v1]", "1-1-2 [v1]"],
				["1-2-0 [v1]", "1-2-1 [v1]", "1-2-2 [v1]"]
			],
			[
				["2-0-0 [v1]", "2-0-1 [v1]", "2-0-2 [v1]"],
				["2-1-0 [v1]", "2-1-1 [v1]", "2-1-2 [v1]"],
				["2-2-0 [v1]", "2-2-1 [v1]", "2-2-2 [v1]"]
			]
		],
		people: [
			{
				name:"John [v1]",
				age:20,
				people: [
					{
						name:"David [v1]",
						age:25,
						people: [
							{
								name:"Mike [v1]",
								age:30
							}
						]
					}
				]
			}
		]
	};

	var obj2 = {
		classname: 'class',
		img: "assets/img1.jpg",
		imgrep: [
			"img",
			"img"
		],
		rep: [
			{val:"val 1", hide: true},
			{val:"val 2", hide: false},
			{val:"val 3", hide: true}
		],
		hideValue: true,
		showValue: true,
		link: "http://www.google.com/",
		test1:"String 1 [v2]",
		test2:"String 2 [v2]",
		test3: {
			obj: {
				val: "val3 [v2]",
				cl: "myClass3"
			}
		},
		params: {
			param1: "p1.p1",
			param2: "p2.p2"
		},
		getClass: function(){ return "myClassA"; },
		fnParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "fn value [v2]" : undefined; },
		getClassParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "myClass5" : undefined; },
		functions: {
			getClass: function(){ return "myClass3"; },
			getClassParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "myClass6" : undefined; },
			fn1: function(){ return "fn string returned [v2]"; },
			fn2: function(p1, p2){ return "fn string returned with: " + p1 + " " + p2 + " [v2]"; },
			fnParam: function(p1, p2){ return p1 === "p1.p1" && p2 === "p2.p2" ? "fn value [v2]" : undefined; },
			checked: function() { return "checked"; },
			hideFn: function(){ return true; },
			showFn: function(){ return true; },
			deep: {
				fn1: function(){ return "fn deep string returned [v2]"; }
			}
		},
		cl:"myClass3",
		cl2:"myClass4",
		checked: "checked",
		items: [{name:"zero [v2]", deep:{other:"1 [v2]"}}, {name:"one [v2]", deep:{other:"2 [v2]"}}, {name:"two [v2]", deep:{other:"3 [v2]"}}],
		arr:["zero [v2]", "one [v2]", "two [v2]"],
		obj: {
			item1: {
				title: "object containing arrays 1 [v2]",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			}
		},
		objarray: [
			{
				title: "object containing arrays 1",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			},
			{
				title: "object containing arrays 1",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			},
			{
				title: "object containing arrays 1",
				data: {
					arr: [1, 2, 3]
				},
				hide:false
			}
		],
		l0: [
				[
					["0-0-1 [v2]", "0-0-1 [v2]", "0-0-2 [v2]"],
					["0-1-1 [v2]", "0-1-1 [v2]", "0-1-2 [v2]"],
					["0-2-1 [v2]", "0-2-1 [v2]", "0-2-2 [v2]"]
				],
				[
					["1-0-1 [v2]", "1-0-1 [v2]", "1-0-2 [v2]"],
					["1-1-1 [v2]", "1-1-1 [v2]", "1-1-2 [v2]"],
					["1-2-1 [v2]", "1-2-1 [v2]", "1-2-2 [v2]"]
				],
				[
					["2-0-1 [v2]", "2-0-1 [v2]", "2-0-2 [v2]"],
					["2-1-1 [v2]", "2-1-1 [v2]", "2-1-2 [v2]"],
					["2-2-1 [v2]", "2-2-1 [v2]", "2-2-2 [v2]"]
				]
		],
		people: [
			{
				name:"John [v2]",
				age:20,
				people: [
					{
						name:"David [v2]",
						age:25,
						people: [
							{
								name:"Mike [v2]",
								age:30
							}
						]
					}
				]
			}
		]
	};

	var obj;
	var objA;
	var objB;

	var ct = document.getElementById('ct');
	var ct2 = document.getElementById('ct2');
	var tpl = soma.template.create(ct);
	var tpl2 = soma.template.create(ct2);
//	var tpl1 = soma.template.compile(ct);
//	var scope1 = tpl1.scope;
//	var ct2 = document.getElementById('ct2');
//	var tpl2 = soma.template.compile(ct2);

//	tpl.watch('item.name', function(oldValue, newValue, scope, node, attribute) {
////		console.log(0, oldValue, newValue, node, scope, attribute);
//		return "Paul";
//	});
//	var count = 2;
//	tpl.watch('cl', function(oldValue, newValue, node, scope, attribute) {
////		console.log(0, oldValue, newValue, node, scope, attribute);
////		return "myClass" + count++ % 6;
//	});

	$('.render1').click(render1);
	$('.render2').click(render2);
	$('.render-all').click(renderAll);
	$('.invalidate').click(invalidate);

//	var count = 0;
//
	function create() {

	}
	function render1() {
//		if (count % 2 === 0) {
			objA = objA === obj1 ? obj2 : obj1;
//		}
		var time = new Date().getTime();
		tpl.render(objA);
		$('.time').html(new Date().getTime() - time);
	}
	function render2() {
//		if (count % 2 === 0) {
			objB = objB === obj1 ? obj2 : obj1;
//		}
		var time = new Date().getTime();
		tpl2.render(objB);
		$('.time').html(new Date().getTime() - time);
	}
	function invalidate() {
		tpl.invalidate();
		tpl2.invalidate();
	};
	function renderAll() {
//		if (count % 2 === 0) {
		objA = objA === obj1 ? obj2 : obj1;
		objB = objB === obj2 ? obj1 : obj2;
//		}
		var time = new Date().getTime();
		tpl.update(objA);
		tpl2.update(objB);
		soma.template.renderAll();
		$('.time').html(new Date().getTime() - time);
	}
//	function compile2() {
//		//tpl2 = soma.template.compile(document.getElementById('ct2'));
//	}
//	function render2() {
//		tpl2.render({test1:"name 1 [tpl2][v1]",test2:"test 2 [tpl2][v1]"});
//	}

</script>

</body>
</html>